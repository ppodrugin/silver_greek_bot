# Система статистики для пользователей

## Описание

Бот поддерживает расширенную статистику для определенных пользователей. Для пользователей из списка отслеживаемых ведется детальная статистика по каждому слову, что позволяет адаптивно подбирать слова для тренировки.

## Как добавить пользователя в список

### Способ 1: Через команды бота (рекомендуется)

1. Узнайте `user_id` пользователя через бота [@userinfobot](https://t.me/userinfobot)
2. Отправьте боту команду: `/add_user <user_id>`
   - Пример: `/add_user 123456789`
3. Пользователь сразу будет добавлен в список

### Управление пользователями

- `/add_user <user_id>` - Добавить пользователя в список отслеживаемых
- `/remove_user <user_id>` - Удалить пользователя из списка
- `/list_users` - Показать список всех отслеживаемых пользователей

### Как узнать свой user_id

Используйте бота [@userinfobot](https://t.me/userinfobot) в Telegram - он покажет ваш ID.

## Как работает статистика

### Для отслеживаемых пользователей:

1. **Детальная статистика по словам:**
   - Для каждого слова ведется счетчик успешных и неуспешных попыток
   - Статистика сохраняется в базе данных

2. **Умный подбор слов:**
   - Бот показывает только те слова, где разница между успешными и неуспешными попытками меньше 3
   - Это означает, что слова, которые вы уже хорошо знаете (разница >= 3), не будут показываться
   - Фокус на словах, которые нужно повторить

3. **Команда `/reset_stats`:**
   - Сбрасывает всю статистику по словам для пользователя
   - После сброса все слова снова доступны для тренировки

### Для обычных пользователей:

- Статистика не ведется
- Слова выбираются случайно из всего словаря
- Команда `/reset_stats` недоступна

## Команды

- `/training` - Начать тренировку (для отслеживаемых пользователей - умный подбор слов)
- `/stats` - Показать общую статистику
- `/reset_stats` - Сбросить статистику по словам (только для отслеживаемых пользователей)

## Примеры использования

### Добавление пользователя:

1. Пользователь получает свой ID через команду `/my_id` или бота @userinfobot (например, `123456789`)
2. Администратор отправляет команду `/add_user 123456789`
3. Пользователь сразу добавляется в базу данных
4. Теперь для этого пользователя ведется статистика

### Сброс статистики:

Если пользователь хочет начать заново:
1. Отправляет команду `/reset_stats`
2. Вся статистика по словам удаляется
3. Все слова снова доступны для тренировки

## Технические детали

- Статистика хранится в таблице `word_statistics` в базе данных (SQLite локально, PostgreSQL на Render)
- Связь: `user_id` + `word_id` (из таблицы `vocabulary`)
- При удалении слова из словаря статистика по нему также удаляется (CASCADE)
- Для анонимных пользователей (без user_id) статистика не ведется
- Пользователи хранятся в таблице `users` с флагом `is_tracked`

