# Деплой Telegram бота

Это руководство поможет вам опубликовать бота на бесплатном хостинге.

## Варианты бесплатного хостинга

### 1. Railway (Рекомендуется) ⭐
- **Бесплатно**: $5 кредита в месяц
- **Простота**: Очень простой деплой через GitHub
- **Автоматический деплой**: При каждом push в GitHub
- **URL**: https://railway.app

### 2. Render
- **Бесплатно**: Да, но может "засыпать" после неактивности
- **Простота**: Простой деплой через GitHub
- **URL**: https://render.com

### 3. Fly.io
- **Бесплатно**: Да, с ограничениями
- **Простота**: Средняя, требует CLI
- **URL**: https://fly.io

## Подготовка к деплою

### Шаг 1: Проверьте файлы

Убедитесь, что у вас есть:
- ✅ `requirements.txt` - список зависимостей
- ✅ `bot.py` - главный файл бота
- ✅ `.env.example` - пример файла с переменными окружения
- ✅ `.gitignore` - файл для игнорирования ненужных файлов

### Шаг 2: Создайте Procfile (для Railway/Render)

Создайте файл `Procfile` в корне проекта:

```
worker: python3 bot.py
```

### Шаг 3: Создайте runtime.txt (опционально)

Если нужна конкретная версия Python, создайте `runtime.txt`:

```
python-3.11.0
```

## Деплой на Railway (Рекомендуется)

### Шаг 1: Создайте аккаунт
1. Перейдите на https://railway.app
2. Войдите через GitHub

### Шаг 2: Создайте новый проект
1. Нажмите "New Project"
2. Выберите "Deploy from GitHub repo"
3. Выберите ваш репозиторий с ботом
4. Railway автоматически определит Python проект

### Шаг 3: Настройте переменные окружения
1. В проекте Railway перейдите в "Variables"
2. Добавьте переменные:
   - `TELEGRAM_BOT_TOKEN` - ваш токен бота
   - `OPENAI_API_KEY` - ваш OpenAI API ключ (опционально)

### Шаг 4: Настройте деплой
1. Railway автоматически определит команду запуска из `Procfile`
2. Если нет Procfile, добавьте в настройках проекта:
   - **Start Command**: `python3 bot.py`

### Шаг 5: Деплой
1. Railway автоматически задеплоит проект
2. Проверьте логи в разделе "Deployments"
3. Бот должен запуститься автоматически

## Деплой на Render

### Шаг 1: Создайте аккаунт
1. Перейдите на https://render.com
2. Войдите через GitHub

### Шаг 2: Создайте новый Web Service
1. Нажмите "New +" → "Web Service"
2. Подключите ваш GitHub репозиторий
3. Выберите репозиторий с ботом

### Шаг 3: Настройте сервис
- **Name**: telegram-bot (или любое имя)
- **Environment**: Python 3
- **Build Command**: `pip install -r requirements.txt`
- **Start Command**: `python3 bot.py`

### Шаг 4: Добавьте переменные окружения
В разделе "Environment Variables" добавьте:
- `TELEGRAM_BOT_TOKEN`
- `OPENAI_API_KEY` (опционально)

### Шаг 5: Деплой
1. Нажмите "Create Web Service"
2. Render начнет деплой
3. Проверьте логи

**Важно**: Render может "засыпать" после неактивности. Для ботов лучше использовать **Background Worker** вместо Web Service.

### Альтернатива: Background Worker на Render
1. "New +" → "Background Worker"
2. Настройки те же, но это предотвратит "засыпание"

## Деплой на Fly.io

### Шаг 1: Установите Fly CLI
```bash
curl -L https://fly.io/install.sh | sh
```

### Шаг 2: Войдите
```bash
fly auth login
```

### Шаг 3: Создайте приложение
```bash
cd telegram_bot
fly launch
```

### Шаг 4: Настройте переменные окружения
```bash
fly secrets set TELEGRAM_BOT_TOKEN=your_token_here
fly secrets set OPENAI_API_KEY=your_key_here
```

### Шаг 5: Деплой
```bash
fly deploy
```

## Важные моменты

### 1. База данных
- SQLite файл (`vocabulary.db`) будет создаваться автоматически
- На бесплатном хостинге файлы могут удаляться при перезапуске
- Для продакшена лучше использовать внешнюю БД (PostgreSQL на Railway/Render)

### 2. Переменные окружения
**НИКОГДА** не коммитьте файл `.env` в Git!
- Используйте переменные окружения на хостинге
- Файл `.env` уже в `.gitignore`

### 3. Логи
- Все логи будут доступны в панели управления хостинга
- Используйте `logger` вместо `print()` (уже исправлено)

### 4. Файлы
- Временные файлы (`temp_audio_*.ogg`) создаются и удаляются автоматически
- Убедитесь, что у бота есть права на запись в рабочую директорию

## Проверка работы

После деплоя:
1. Проверьте логи на хостинге
2. Отправьте `/start` боту в Telegram
3. Проверьте, что бот отвечает

## Миграция на PostgreSQL (опционально)

Для продакшена рекомендуется использовать PostgreSQL вместо SQLite:

1. Создайте PostgreSQL базу на хостинге
2. Обновите `database.py` для работы с PostgreSQL
3. Используйте переменные окружения для подключения

## Поддержка

Если возникли проблемы:
1. Проверьте логи на хостинге
2. Убедитесь, что все переменные окружения установлены
3. Проверьте, что `requirements.txt` содержит все зависимости

